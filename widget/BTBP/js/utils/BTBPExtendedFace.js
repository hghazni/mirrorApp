(function(a){a.BTBPExtendedFace=function(){this.vertices=[];this.triangles=[];this.points=[];this.bounds=new a.Rectangle(0,0,0,0);this._tmpPoint0=new a.Point;this._tmpPoint1=new a.Point;this._tmpPoint2=new a.Point;this._tmpPoint3=new a.Point;this._tmpPoint4=new a.Point;this._tmpPoint5=new a.Point};a.BTBPExtendedFace.prototype.update=function(l){var b,c;b=this.points.length;for(c=l.points.length+6;b<c;++b)this.points[b]=new a.Point(0,0);this.generateExtendedVertices(l);this.generateExtendedTriangles(l);
this.updateBounds();this.updatePoints()};a.BTBPExtendedFace.prototype.generateExtendedVertices=function(a){a=a.vertices;var b,c;b=this.vertices.length=0;for(c=a.length;b<c;b++)this.vertices[b]=a[b];this.addUpperForeheadPoints(this.vertices)};a.BTBPExtendedFace.prototype.generateExtendedTriangles=function(a){0===this.triangles.length&&(this.triangles=a.triangles.concat(),this.triangles.push(0,17,68,17,18,68,18,19,69,18,68,69,19,20,69,20,23,71,20,69,70,20,70,71,23,24,72,23,71,72,24,25,72,25,26,73,25,
72,73,16,26,73))};a.BTBPExtendedFace.prototype.updateBounds=function(){var a=0,b=0,c=9999,d=9999,e,g,f;e=0;for(g=this.vertices.length;e<g;e++)f=this.vertices[e],0===e%2?(f<a&&(a=f),f>c&&(c=f)):(f<b&&(b=f),f>d&&(d=f));this.bounds.x=a;this.bounds.y=b;this.bounds.width=c-a;this.bounds.height=d-b};a.BTBPExtendedFace.prototype.updatePoints=function(){var a,b,c,d,e;b=a=0;for(c=this.points.length;a<c;++a)d=this.vertices[b],b++,e=this.vertices[b],b++,this.points[a].x=d,this.points[a].y=e};a.BTBPExtendedFace.prototype.addUpperForeheadPoints=
function(a){var b=this._tmpPoint0,c=this._tmpPoint1,d=this._tmpPoint2,e=this._tmpPoint3,g=this._tmpPoint4,f=this._tmpPoint5;this.setPoint(a,33,b);this.setPoint(a,27,c);var h=1.2*this.calcDistance(b,c);this.setPoint(a,39,b);this.setPoint(a,42,c);var k=this.calcDistance(b,c);this.calcMovementVectorOrthogonalCCW(g,b,c,h/k);this.setPoint(a,27,d);this.applyMovementVector(e,d,g,10.95);this.applyMovementVector(d,d,g,-10.95);this.calcIntersectionPoint(f,d,e,b,c);h=.5-this.calcDistance(b,f)/k;this.setPoint(a,
0,f);var m=.75*this.calcDistance(b,f);this.interpolatePoint(d,b,c,m/-k);this.applyMovementVector(e,d,g,.75);this.addToExtendedVertices(e);this.interpolatePoint(d,b,c,h-.65);this.applyMovementVector(e,d,g,1.02);this.addToExtendedVertices(e);this.interpolatePoint(d,b,c,h);this.applyMovementVector(e,d,g,1.1);this.addToExtendedVertices(e);this.interpolatePoint(d,b,c,h+1);this.applyMovementVector(e,d,g,1.1);this.addToExtendedVertices(e);this.interpolatePoint(d,b,c,h+1.65);this.applyMovementVector(e,d,
g,1.02);this.addToExtendedVertices(e);this.setPoint(a,16,f);m=.75*this.calcDistance(c,f);this.interpolatePoint(d,c,b,m/-k);this.applyMovementVector(e,d,g,.75);this.addToExtendedVertices(e)};a.BTBPExtendedFace.prototype.addToExtendedVertices=function(a){this.vertices.push(a.x);this.vertices.push(a.y)};a.BTBPExtendedFace.prototype.setPoint=a.BTBPPointUtils.setPoint;a.BTBPExtendedFace.prototype.applyMovementVector=a.BTBPPointUtils.applyMovementVector;a.BTBPExtendedFace.prototype.interpolatePoint=a.BTBPPointUtils.interpolatePoint;
a.BTBPExtendedFace.prototype.calcMovementVector=a.BTBPPointUtils.calcMovementVector;a.BTBPExtendedFace.prototype.calcMovementVectorOrthogonalCW=a.BTBPPointUtils.calcMovementVectorOrthogonalCW;a.BTBPExtendedFace.prototype.calcMovementVectorOrthogonalCCW=a.BTBPPointUtils.calcMovementVectorOrthogonalCCW;a.BTBPExtendedFace.prototype.calcIntersectionPoint=a.BTBPPointUtils.calcIntersectionPoint;a.BTBPExtendedFace.prototype.calcDistance=a.BTBPPointUtils.calcDistance})(btbpv4);
